<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python教程 - 小白爱分享</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* Python 教程页面专用样式 */
        .tutorial-layout {
            max-width: 90%;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            gap: 15px;
            min-height: calc(100vh - 80px);
        }

        /* 左侧导航栏 */
        .tutorial-nav {
            width: 250px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.1);
            border: 1px solid #e9d5ff;
            overflow-y: auto;
            max-height: calc(100vh - 120px);
            position: sticky;
            top: 80px;
            scrollbar-width: none;
            /* Firefox 隐藏滚动条 */
            -ms-overflow-style: none;
            /* IE 和 Edge 隐藏滚动条 */
        }

        /* 默认隐藏滚动条 */
        .tutorial-nav::-webkit-scrollbar {
            width: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* 鼠标悬停时显示滚动条 */
        .tutorial-nav:hover {
            scrollbar-width: thin;
            /* Firefox 显示滚动条 */
            -ms-overflow-style: auto;
            /* IE 和 Edge 显示滚动条 */
        }

        .tutorial-nav:hover::-webkit-scrollbar {
            opacity: 1;
        }

        .tutorial-nav-header {
            padding: 20px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-radius: 10px 0 0 0;
            text-align: center;
        }

        .tutorial-nav-header h2 {
            margin: 0;
            font-size: 1.3rem;
        }

        .tutorial-nav-header {
            border-radius: 10px 10px 0 0;
        }

        .tutorial-nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tutorial-nav-item {
            border-bottom: 1px solid #f0f0f0;
        }

        .tutorial-nav-item a {
            display: block;
            padding: 12px 20px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .tutorial-nav-item a:hover {
            background-color: #f3e8ff;
            color: #7c3aed;
            padding-left: 25px;
        }

        .tutorial-nav-item.active a {
            background-color: #e9d5ff;
            color: #7c3aed;
            font-weight: bold;
            border-left: 4px solid #8b5cf6;
        }

        /* 右侧内容区 */
        .tutorial-content {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.1);
            border: 1px solid #e9d5ff;
            overflow: hidden;
            position: relative;
        }

        .tutorial-content-header {
            padding: 20px;
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            border-bottom: 2px solid #8b5cf6;
        }

        .tutorial-content-header h1 {
            margin: 0;
            color: #7c3aed;
            font-size: 1.8rem;
        }

        .tutorial-iframe-container {
            width: 100%;
            height: calc(100vh - 200px);
            overflow: hidden;
        }

        .tutorial-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* 加载提示 */
        .loading-message {
            text-align: center;
            padding: 50px 20px;
            color: #7c3aed;
            font-size: 1.2rem;
        }

        /* 滚动条轨道样式 */
        .tutorial-nav::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .tutorial-nav::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 4px;
        }

        .tutorial-nav::-webkit-scrollbar-thumb:hover {
            background: #7c3aed;
        }

        /* 为嵌入的 iframe 内容添加代码块样式 */
        .tutorial-iframe-container {
            position: relative;
        }
    </style>
</head>

<body>
    <!-- 导航栏 -->
    <nav id="mainNav"></nav>

    <!-- 教程布局 -->
    <div class="tutorial-layout">
        <!-- 左侧教程导航 -->
        <div class="tutorial-nav">
            <div class="tutorial-nav-header">
                <h2>Python 教程导航</h2>
            </div>
            <ul class="tutorial-nav-list" id="tutorialNavList">
                <!-- 通过 JavaScript 动态生成 -->
            </ul>
        </div>

        <!-- 右侧教程内容 -->
        <div class="tutorial-content">
            <div class="tutorial-content-header">
                <h1 id="currentTutorialTitle">Python 基础教程</h1>
            </div>
            <div class="tutorial-iframe-container">
                <iframe id="tutorialFrame" class="tutorial-iframe" src="python/python-tutorial.html"></iframe>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer id="mainFooter"></footer>

    <script src="../js/data.js"></script>
    <script src="../js/main.js"></script>
    <script type="module">
        // 导入 Python 导航数据
        import pyNavigation from '../js/pyNavigation.js';

        // 页面加载完成后执行初始化
        document.addEventListener('DOMContentLoaded', function () {
            // 生成顶部导航栏
            generateNavigation();

            // 生成页脚
            generateFooter();

            // 生成教程导航列表
            generateTutorialNav();

            // 从 URL 参数中获取要显示的教程
            const urlParams = new URLSearchParams(window.location.search);
            const tutorialUrl = urlParams.get('tutorial');
            if (tutorialUrl) {
                loadTutorial(tutorialUrl);
            }
        });

        // 生成教程导航列表
        function generateTutorialNav() {
            const navList = document.getElementById('tutorialNavList');
            let navHTML = '';

            pyNavigation.forEach((item, index) => {
                const isActive = index === 0 ? 'active' : '';
                navHTML += `
                    <li class="tutorial-nav-item ${isActive}" data-url="${item.url}">
                        <a href="#" onclick="loadTutorialFromNav('${item.url}', '${item.name}', event)">
                            ${item.name}
                        </a>
                    </li>
                `;
            });

            navList.innerHTML = navHTML;
        }

        // 从导航加载教程
        window.loadTutorialFromNav = function (url, title, event) {
            if (event) {
                event.preventDefault();
            }

            // 更新活动状态
            document.querySelectorAll('.tutorial-nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const activeItem = document.querySelector(`[data-url="${url}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }

            // 更新标题
            document.getElementById('currentTutorialTitle').textContent = title;

            // 加载教程内容
            loadTutorial(url);

            // 更新 URL（不刷新页面）
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('tutorial', url);
            window.history.pushState({}, '', newUrl);
        };

        // 加载教程内容到 iframe
        function loadTutorial(url) {
            const iframe = document.getElementById('tutorialFrame');
            iframe.src = url;

            // 监听 iframe 加载完成
            iframe.onload = function () {
                injectCodeStyles(iframe);
                updateActiveNavByIframeUrl(iframe);
            };
        }

        // 根据 iframe 当前 URL 更新左侧导航激活状态
        function updateActiveNavByIframeUrl(iframe) {
            try {
                // 获取 iframe 当前的 URL
                const iframeUrl = iframe.contentWindow.location.href;
                const iframePath = iframe.contentWindow.location.pathname;

                // 从路径中提取文件名
                const fileName = iframePath.split('/').pop();

                console.log('iframe 当前页面:', fileName);

                // 查找匹配的导航项
                pyNavigation.forEach((item, index) => {
                    const itemFileName = item.url.split('/').pop();

                    if (itemFileName === fileName) {
                        // 清除所有激活状态
                        document.querySelectorAll('.tutorial-nav-item').forEach(navItem => {
                            navItem.classList.remove('active');
                        });

                        // 激活匹配的导航项
                        const activeItem = document.querySelector(`[data-url="${item.url}"]`);
                        if (activeItem) {
                            activeItem.classList.add('active');

                            // 更新标题
                            document.getElementById('currentTutorialTitle').textContent = item.name;

                            // 滚动到可视区域
                            activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

                            console.log('已激活导航项:', item.name);
                        }
                    }
                });

            } catch (error) {
                console.log('无法访问 iframe URL（可能是跨域）:', error);
            }
        }

        // 为 iframe 内的代码块注入样式和高亮
        function injectCodeStyles(iframe) {
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

                // 检查是否已经注入过样式
                if (iframeDoc.getElementById('injected-code-highlight-style')) {
                    return;
                }

                // 创建样式标签
                const style = iframeDoc.createElement('style');
                style.id = 'injected-code-highlight-style';
                style.textContent = `
                    /* 代码块浅灰色背景和美化 */
                    .example_code {
                        background: #f5f5f5 !important;
                        border-radius: 6px !important;
                        padding: 15px !important;
                        border: 1px solid #ddd !important;
                        line-height: 1.6 !important;
                        overflow-x: auto !important;
                    }
                    
                    /* 代码格式化和换行 */
                    .example_code,
                    .example_code *,
                    .example_code .hl-main,
                    .example_code div,
                    .example_code span {
                        white-space: pre-wrap !important;
                        word-wrap: break-word !important;
                        word-break: break-word !important;
                        font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
                        font-size: 14px !important;
                        line-height: 1.6 !important;
                    }
                    
                    /* pre 标签浅绿色背景 */
                    pre {
                        background: #e8f5e9 !important;
                        border-radius: 6px !important;
                        padding: 12px 15px !important;
                        margin: 10px 0 !important;
                        border: 1px solid #a5d6a7 !important;
                        white-space: pre-wrap !important;
                        word-wrap: break-word !important;
                        overflow-x: auto !important;
                    }
                    
                    /* Python 语法高亮颜色 */
                    .example_code .hl-comment {
                        color: #008000 !important;
                        font-style: italic !important;
                    }
                    
                    .example_code .hl-identifier {
                        color: #0000FF !important;
                        font-weight: bold !important;
                    }
                    
                    .example_code .hl-string {
                        color: #A31515 !important;
                    }
                    
                    .example_code .hl-quotes {
                        color: #A31515 !important;
                    }
                    
                    .example_code .hl-brackets {
                        color: #000000 !important;
                    }
                    
                    .example_code .hl-code {
                        color: #000000 !important;
                    }
                    
                    .example_code .hl-number {
                        color: #098658 !important;
                    }
                    
                    .example_code .hl-reserved {
                        color: #0000FF !important;
                        font-weight: bold !important;
                    }
                    
                    .example_code .hl-builtin {
                        color: #795E26 !important;
                    }
                            
                    /* 隐藏运行实例按钮 */
                    .showbtn,
                    a.showbtn,
                    .tryitbtn,
                    a.tryitbtn {
                        display: none !important;
                    }
                `;

                // 注入样式到 iframe
                iframeDoc.head.appendChild(style);

                console.log('代码样式已注入：背景改为浅灰色，按钮已隐藏');

                // 拦截 iframe 内的链接点击，确保在 iframe 内跳转
                interceptIframeLinks(iframeDoc);

            } catch (error) {
                console.error('注入代码样式失败（可能是跨域问题）:', error);
            }
        }

        // 拦截 iframe 内的链接点击
        function interceptIframeLinks(iframeDoc) {
            try {
                // 获取所有链接
                const links = iframeDoc.querySelectorAll('a');

                links.forEach(link => {
                    const href = link.getAttribute('href');

                    // 只处理相对路径的 Python 教程链接
                    if (href && (href.startsWith('/python/') || href.startsWith('python-') || href.includes('.html'))) {
                        link.addEventListener('click', function (e) {
                            e.preventDefault();

                            let targetUrl = href;

                            // 处理不同格式的链接
                            if (href.startsWith('/python/')) {
                                // 绝对路径：/python/python-xxx.html
                                targetUrl = 'python/' + href.split('/python/')[1];
                            } else if (href.startsWith('python-')) {
                                // 相对路径：python-xxx.html
                                targetUrl = 'python/' + href;
                            } else if (href.includes('/python/')) {
                                // 其他包含 /python/ 的路径
                                const parts = href.split('/python/');
                                targetUrl = 'python/' + parts[parts.length - 1];
                            }

                            console.log('拦截链接点击:', href, '→', targetUrl);

                            // 在父页面的 iframe 中加载
                            const iframe = document.getElementById('tutorialFrame');
                            iframe.src = targetUrl;
                        });
                    }
                });

                console.log('已拦截', links.length, '个链接');

            } catch (error) {
                console.error('拦截链接失败:', error);
            }
        }
    </script>
</body>

</html>